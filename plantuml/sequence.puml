@startuml
!theme plain
autonumber

actor User as user
participant "OrderController" as controller
participant "OrderService" as service
participant "OrderRepository" as repository
participant "ProductService" as productService
database "DB" as db

user -> controller : createOrder(request)
controller -> service : createOrder(userId, items)

' 상품 재고 확인
service -> productService : checkStock(items)
productService -> db : SELECT * FROM products WHERE id IN (...)
db --> productService : products with stock info
productService --> service : validated items

' 주문 생성
service -> repository : save(order)
repository -> db : INSERT INTO orders ...
db --> repository : orderId
repository --> service : saved order

' 주문 상세 저장
loop for each item
    service -> repository : save(orderItem)
    repository -> db : INSERT INTO order_items ...
    db --> repository : success
end

service --> controller : OrderResponse
controller --> user : return 201 Created + order info

@enduml
